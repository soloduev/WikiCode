<!--
    Copyright (C) 2016 Igor Soloduev <diahorver@gmail.com>

    This file is part of WikiCode.

    WikiCode is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    WikiCode is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with WikiCode.  If not, see <http://www.gnu.org/licenses/>.
-->
{% extends 'main.html' %}
{% load bootstrap3 %}
{% block page_name %}
    <div class="container" style="margin-top: 50px;">
        <div class="row">
            <br>
        </div>
    </div>
    <div class="container">
        <div class="row">
        </div>
    </div>
{% endblock %}
{% block content %}
    <div id="main-block" class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12"
                 style="border-left: 1px solid #d5d5d5;border-right: 1px solid #d5d5d5;min-height:500px;border-bottom: 1px solid #d5d5d5;">
                <div class="row">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-4" style="border-right: 1px solid #d5d5d5;min-height:500px;">
                                <div class="row">
                                    <label class="text-center btn-primary btn-block">МОЕ ДЕРЕВО</label>
                                </div>
                                <div class="row">
                                    {% if preview_tree == "NONE" %}
                                        <div class="col-xs-12 text-center">
                                            <label>Дерево отсутствует</label>
                                        </div>
                                    {% else %}
                                        <ul id="tree2">
                                            <!--Здесь должен располагаться сгенерированный html preview дерева-->
                                            {{ preview_tree|safe }}
                                        </ul>
                                        <ul id="tree2saved" class="wiki-tree-saved">
                                            <!--Здесь должен располагаться сгенерированный html дерева с сохраненными конспектами-->
                                            {{ saved_publ|safe }}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-8" style="min-height:500px;">
                                <div class="row">
                                    <label class="text-center btn-primary btn-block">УПРАВЛЕНИЕ ДЕРЕВОМ</label>
                                </div>
                                <div class="row">
                                    <br>
                                </div>
                                <div class="row">
                                    <div id="panel_inputs" class="col-md-12">
                                        <form action="{% url 'create' %}" method="post">
                                            {% csrf_token %}
                                            <div class="btn-group">
                                                <button type="button" id="add_folder_in_wiki_tree" class="btn wiki-style-header-btns">Добавить папку <span class="glyphicon glyphicon-folder-open"></span></button>
                                                <button id="add_publ_in_wiki_tree" class="btn wiki-style-header-btns">Создать конспект <span class="glyphicon glyphicon-list-alt"></span></button>
                                                <button type="button" id="wiki-help-tree-manager" class="btn wiki-style-header-btns"><span class="glyphicon glyphicon-question-sign"></span></button>
                                                <input id="choose-folder-secret" content="secret" name="folder_publ" type="text" hidden value="off"/>
                                            </div>
                                        </form>
                                    </div>
                                    <!--Скрытый блок добавления папки-->
                                    <div id="div_folder_name_input" class="col-xs-12" style="display: none;">
                                        <span><h4>Добавить новую папку</h4></span>
                                        <div class="row">
                                            <div class="col-xs-4">
                                                <input  type="text" class="form-control" id="folder_name_input" placeholder="Имя новой папки..." autofocus style="border-radius: 0px;"/>
                                            </div>
                                            <div class="col-xs-4 text-left">
                                                <div class="btn-group">
                                                    <button id="accept_add_folder_in_wiki_tree" class="btn wiki-style-header-btns">Добавить <span class="glyphicon glyphicon-folder-open"></span></button>
                                                    <button id="cancel_add_folder_in_wiki_tree" class="btn wiki-style-header-btns"><span class="glyphicon glyphicon-remove"></span></button>
                                                </div>
                                            </div>
                                            <div class="col-xs-4">
                                            </div>
                                        </div>
                                    </div>
                                    <!--Скрытый блок добавления глобальной папки-->
                                    <div id="div_folder_name_input_for_global" class="col-xs-12" style="display: none;">
                                        <span><h4>Добавить новую корневую папку</h4></span>
                                        <div class="row">
                                            <div class="col-xs-4">
                                                <input  type="text" class="form-control" id="folder_name_input_for_global" placeholder="Имя новой папки..." autofocus style="border-radius: 0px;"/>
                                            </div>
                                            <div class="col-xs-4 text-left">
                                                <div class="btn-group">
                                                    <button id="accept_add_global_folder_in_wiki_tree" class="btn wiki-style-header-btns">Добавить <span class="glyphicon glyphicon-folder-open"></span></button>
                                                    <button id="cancel_add_global_folder_in_wiki_tree" class="btn wiki-style-header-btns"><span class="glyphicon glyphicon-remove"></span></button>
                                                </div>
                                            </div>
                                            <div class="col-xs-4">
                                            </div>
                                        </div>
                                    </div>
                                    <!--Скрытый блок подтверждения удаления элемента-->
                                    <div id="div_accept_delete_elem"class="col-xs-12" style="display: none;">
                                        <span><h4 id="deleter-text-tree-manager">Удалить? </h4></span>
                                        <div class="row">
                                            <div class="col-xs-12 text-left">
                                                <div class="btn-group">
                                                    <button id="yes_delete_elem_in_tree" class="btn wiki-style-header-btns">Да <span class="glyphicon glyphicon-check"></span></button>
                                                    <button id="no_delete_elem_in_tree" class="btn wiki-style-header-btns">Нет <span class="glyphicon glyphicon-remove"></span></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--Скрытый блок подтверждения переименования конспекта-->
                                    <div id="div_rename_publ_input" class="col-xs-12" style="display: none;">
                                        <span><h4>Переменовать конспект</h4></span>
                                        <div class="row">
                                            <div class="col-xs-4">
                                                <input  type="text" class="form-control" id="rename_publ_input" placeholder="Новое имя конспекта..." autofocus style="border-radius: 0px;"/>
                                            </div>
                                            <div class="col-xs-8 text-left">
                                                <div class="btn-group">
                                                    <button id="accept_rename_publ_in_wiki_tree" class="btn wiki-style-header-btns">Переименовать <span class="glyphicon glyphicon-list"></span></button>
                                                    <button id="cancel_rename_publ_in_wiki_tree" class="btn wiki-style-header-btns"><span class="glyphicon glyphicon-remove"></span></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--Скрытый блок подтверждения переименования папки-->
                                    <div id="div_rename_folder_input" class="col-xs-12" style="display: none;">
                                        <span><h4>Переменовать папку</h4></span>
                                        <div class="row">
                                            <div class="col-xs-4">
                                                <input  type="text" class="form-control" id="rename_folder_input" placeholder="Новое имя папки..." autofocus style="border-radius: 0px;"/>
                                            </div>
                                            <div class="col-xs-8 text-left">
                                                <div class="btn-group">
                                                    <button id="accept_rename_folder_in_wiki_tree" class="btn wiki-style-header-btns">Переименовать <span class="glyphicon glyphicon-list"></span></button>
                                                    <button id="cancel_rename_folder_in_wiki_tree" class="btn wiki-style-header-btns"><span class="glyphicon glyphicon-remove"></span></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <br>
                                    </div>
                                    <!--Динамическое дерево-->
                                    <div class="col-md-12">
                                        {% if dynamic_tree == "NONE" %}
                                            <div class="row text-center">
                                                <br>
                                                <h4>У вас не создано ни одной папки!</h4>
                                                <br>
                                            </div>
                                        {% else %}
                                            <div id="jstree">
                                                <ul>
                                                    <!--Здесь должен располагаться сгенерированный html код, для динамического дерева-->
                                                    {{ dynamic_tree|safe }}
                                                </ul>
                                            </div>
                                        {% endif %}
                                        <div id="add_global_folder_in_wiki_tree" class="btn btn-block wiki-style-add-new-folder">Добавить корневую папку</div>
                                        <br>
                                    </div>
                                </div>
                                <div class="row">
                                    <label class="text-center btn-primary btn-block">СОХРАНЕННЫЕ КОНСПЕКТЫ</label>
                                </div>
                                <div class="row" id="panel_inputs_for_saved">
                                    <div class="col-md-12">
                                        <br>
                                        <div class="btn-group">
                                            <button type="button" id="add_folder_in_saved_tree" class="btn wiki-style-header-btns">Добавить папку <span class="glyphicon glyphicon-folder-open"></span></button>
                                            <button type="button" id="wiki-help-tree-manager" class="btn wiki-style-header-btns"><span class="glyphicon glyphicon-question-sign"></span></button>
                                        </div>
                                    </div>
                                </div>
                                <!--Скрытый блок добавления папки в дерево для сохраненных конспектов-->
                                <div id="div_folder_name_input_for_saved" class="col-xs-12" style="display: none;">
                                    <span><h4>Добавить новую папку</h4></span>
                                    <div class="row">
                                        <div class="col-xs-4">
                                            <input  type="text" class="form-control" id="folder_name_input_for_saved_tree" placeholder="Имя новой папки..." autofocus style="border-radius: 0px;"/>
                                        </div>
                                        <div class="col-xs-4 text-left">
                                            <div class="btn-group">
                                                <button id="accept_add_folder_in_saved_tree" class="btn wiki-style-header-btns">Добавить <span class="glyphicon glyphicon-folder-open"></span></button>
                                                <button id="cancel_add_folder_in_saved_tree" class="btn wiki-style-header-btns"><span class="glyphicon glyphicon-remove"></span></button>
                                            </div>
                                        </div>
                                        <div class="col-xs-4">
                                        </div>
                                    </div>
                                </div>
                                <!--Скрытый блок подтверждения удаления папки в дереве сохраненных конспектов-->
                                    <div id="div_accept_delete_elem_saved"class="col-xs-12" style="display: none;">
                                        <span><h4 id="deleter-text-tree-manager_saved">Удалить? </h4></span>
                                        <div class="row">
                                            <div class="col-xs-12 text-left">
                                                <div class="btn-group">
                                                    <button id="yes_delete_elem_in_tree_saved" class="btn wiki-style-header-btns">Да <span class="glyphicon glyphicon-check"></span></button>
                                                    <button id="no_delete_elem_in_tree_saved" class="btn wiki-style-header-btns">Нет <span class="glyphicon glyphicon-remove"></span></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <!--Скрытый блок подтверждения удаления конспекта в дереве сохраненных конспектов-->
                                    <div id="div_accept_delete_publ_saved"class="col-xs-12" style="display: none;">
                                        <span><h4 id="deleter-text-tree-manager_saved_publ">Удалить этот конспект? </h4></span>
                                        <div class="row">
                                            <div class="col-xs-12 text-left">
                                                <div class="btn-group">
                                                    <button id="yes_delete_elem_in_tree_saved_publ" class="btn wiki-style-header-btns">Да <span class="glyphicon glyphicon-check"></span></button>
                                                    <button id="no_delete_publ_in_tree_saved" class="btn wiki-style-header-btns">Нет <span class="glyphicon glyphicon-remove"></span></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <div class="row">
                                    <!--Дерево сохраненных конспектов-->
                                    <div class="col-md-12">
                                        <br>
                                        <div id="jstree-saved">
                                            <ul>
                                                <!--Здесь должен располагаться сгенерированный html код, для динамического дерева сохраненных конспектов-->
                                                {{ dynamic_tree_saved|safe }}
                                            </ul>
                                        </div>
                                        <br><br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <nav id="context-menu" class="context-menu">
        <ul class="context-menu__items">
            <li id="lt-context-menu-1" class="context-menu__item"><a id="open_publ_in_wiki_tree_context" href="#" class="context-menu__link" data-action="Open" style="text-decoration: none;"><i class="fa fa-eye"></i> Смотреть</a></li>
            <li id="lt-context-menu-6-1"  class="context-menu__item"><a id="rename_publ_in_wiki_tree_context" href="#" class="context-menu__link" data-action="Rename Publ" style="text-decoration: none;"><i class="fa fa-text-width"></i> Переименовать</a></li>
            <li id="lt-context-menu-3"  class="context-menu__item"><a id="open_settings_publ_in_wiki_tree_context" href="#" class="context-menu__link" data-action="Settings" style="text-decoration: none;"><i class="fa fa-gear"></i> Настройки</a></li>
            <li id="lt-context-menu-3-0"  class="context-menu__item"><a href="#" class="context-menu__link" data-action="Move Publ" style="text-decoration: none;" data-toggle="modal" data-target="#modal_develop_func"><i class="fa fa-hand-grab-o"></i> Переместить</a></li>
            <li id="lt-context-menu-3-1"  class="context-menu__item"><a id="set_preview_publ_in_wiki_tree_context" href="#" class="context-menu__link" data-action="Set Preview" style="text-decoration: none;"><i class="fa fa-graduation-cap"></i> Сделать превью-конспектом</a></li>
            <li id="lt-context-menu-4"  class="context-menu__item"><a id="add_folder_in_wiki_tree_context" href="#" class="context-menu__link" data-action="Create folder" style="text-decoration: none;"><i class="fa fa-folder-open"></i> Создать папку</a></li>
            <li id="lt-context-menu-5"  class="context-menu__item"><a id="create_publ_in_wiki_tree_context" href="#" class="context-menu__link" data-action="Create publ" style="text-decoration: none;"><i class="fa fa-list-alt"></i> Создать конспект</a></li>
            <li id="lt-context-menu-6"  class="context-menu__item"><a id="rename_folder_in_wiki_tree_context" href="#" class="context-menu__link" data-action="Rename Folder" style="text-decoration: none;"><i class="fa fa-text-width"></i> Переименовать</a></li>
            <li id="lt-context-menu-9"  class="context-menu__item"><a href="#" class="context-menu__link" data-action="Move Folder" style="text-decoration: none;" data-toggle="modal" data-target="#modal_develop_func"><i class="fa fa-hand-grab-o"></i> Переместить</a></li>
            <li id="lt-context-menu-7"  class="context-menu__item"><a href="#" class="context-menu__link" data-action="Sort" style="text-decoration: none;" data-toggle="modal" data-target="#modal_develop_func"><i class="fa fa-sort"></i> Сортировать конспекты</a></li>
            <li id="lt-context-menu-8"  class="context-menu__item"><a id="delete_folder_in_wiki_tree_context" href="#" class="context-menu__link" data-action="Delete Folder" style="text-decoration: none;"><i class="fa fa-times"></i> Удалить папку</a></li>
            <!--Контекстные менюшки для сохраненных публикаций-->
            <!--Папки-->
            <li id="lt-context-menu-saved-folder-1"  class="context-menu__item"><a id="create-folder-for-saved-tree" href="#" class="context-menu__link" data-action="Create Folder for Saved Tree" style="text-decoration: none;"><i class="fa fa-folder-open"></i> Создать папку</a></li>
            <li id="lt-context-menu-saved-folder-2"  class="context-menu__item"><a id="rename-folder-for-saved-tree" href="#" class="context-menu__link" data-action="Rename Folder for Saved Tree" style="text-decoration: none;" data-toggle="modal" data-target="#modal_develop_func"><i class="fa fa-text-width"></i> Переименовать</a></li>
            <li id="lt-context-menu-saved-folder-3"  class="context-menu__item"><a id="move-folder-for-saved-tree" href="#" class="context-menu__link" data-action="Move Folder for Saved Tree" style="text-decoration: none;" data-toggle="modal" data-target="#modal_develop_func"><i class="fa fa-hand-grab-o"></i> Переместить</a></li>
            <li id="lt-context-menu-saved-folder-4"  class="context-menu__item"><a id="sort-folder-for-saved-tree" href="#" class="context-menu__link" data-action="Sort Folder for Saved Tree" style="text-decoration: none;" data-toggle="modal" data-target="#modal_develop_func"><i class="fa fa-sort"></i> Сортировать</a></li>
            <li id="lt-context-menu-saved-folder-5"  class="context-menu__item"><a id="delete-folder-for-saved-tree" href="#" class="context-menu__link" data-action="Delete Folder for Saved Tree" style="text-decoration: none;"><i class="fa fa-times"></i> Удалить</a></li>
            <!--Публикации-->
            <li id="lt-context-menu-saved-publ-1" class="context-menu__item"><a id="open-publ-for-saved-tree" href="#" class="context-menu__link" data-action="Open Publ Saved Tree" style="text-decoration: none;"><i class="fa fa-eye"></i> Смотреть</a></li>
            <li id="lt-context-menu-saved-publ-2" class="context-menu__item"><a id="move-publ-for-saved-tree" href="#" class="context-menu__link" data-action="Open Publ Saved Tree" style="text-decoration: none; " data-toggle="modal" data-target="#modal_develop_func"><i class="fa fa-hand-grab-o"></i> Переместить</a></li>
            <li id="lt-context-menu-saved-publ-3" class="context-menu__item"><a id="remove-publ-for-saved-tree" href="#" class="context-menu__link" data-action="Open Publ Saved Tree" style="text-decoration: none;"><i class="fa fa-times"></i> Убрать</a></li>
        </ul>
    </nav>
{% endblock %}

{% block add_script %}
    {% load staticfiles %}
    <!--Подключаем библиотеку для динамических файловых деревье jsTree-->
    <script src={% static "wiki/jsTree/jstree.min.js"%}></script>
    <!--jsTree-->
    <link href={% static "wiki/jsTree/themes/default/style.min.css"%} rel="stylesheet" >
    <script src={% static "wiki/tree_manager_scripts/actions.js"%}></script>
    <script src={% static "wiki/tree_context_menu/script.js"%}></script>
    <link href={% static "wiki/tree_context_menu/style.css" %} type="text/css" rel="stylesheet">
    <link href={% static "wiki/wiki_styles/tree_manager.css" %} type="text/css" rel="stylesheet">
{% endblock %}

