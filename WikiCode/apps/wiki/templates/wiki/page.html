{% extends 'main.html' %}
{% load bootstrap3 %}
{% block page_name %}
    <div class="container" style="margin-top: 50px;" xmlns="http://www.w3.org/1999/html">
        <div class="row">
            <br>
        </div>
    </div>
    <div class="container">
        <div class="row">
        </div>
    </div>
{% endblock %}
{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12"
                 style="border: 1px solid #d5d5d5;min-height:100px;border-bottom: none;">
                <div class="row">
                    <!--
                    <br>
                    <div class="col-xs-2">
                        <img src="http://placehold.it/100x100">
                    </div>
                    <div class="col-xs-10">

                    </div>
                    -->
                </div>

            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12"
                 style="border-left: 1px solid #d5d5d5;border-right: 1px solid #d5d5d5;min-height:500px;border-bottom: 1px solid #d5d5d5;">
                <div class="row">
                    <div class="tabbable-panel" style="border-bottom: 0px solid #000000; border-top: 0px solid black;">
                        <div class="tabbable-pills">
                            <ul class="nav nav-tabs" style="border-bottom: none;">
                                <li class="active">
                                    <a href="#tab_default_1" data-toggle="tab">
                                        Read mode </a>
                                </li>
                                <li>
                                    <a href="#tab_default_2" data-toggle="tab">
                                        Commenting mode</a>
                                </li>
                                <li>
                                    <a href="#tab_default_3" data-toggle="tab">
                                        Edit mode </a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="tab_default_1">
                                    <div class="col-xs-12 col-sm-12 col-md-12"
                                         style="border-left: 1px solid #d5d5d5;border-right: 1px solid #d5d5d5;min-height:500px;border-bottom: 1px solid #d5d5d5; border-top: 1px solid #d5d5d5;">
                                        <div class="row">

                                            <iframe class="btn-block" id="frame1" name="frame1"
                                                    src="{{ publication.html_page.url }}"
                                                    onload="FrameManager.registerFrame(this)" scrolling="no"
                                                    frameborder="0" marginheight="0"
                                                    marginwidth="0">

                                            </iframe>

                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="tab_default_2">

                                </div>
                                <div class="tab-pane" id="tab_default_3">
                                    <style>
                                        .md-btn:hover {
                                            background-color: white;
                                            border-radius: 0px;
                                            color: #337ab7;
                                        }

                                        .md-btn {
                                            border: 0px solid black;
                                            background-color: white;
                                            color: white;
                                        }

                                        .md-comment:hover {
                                            background-color: white;
                                            border-radius: 0px;
                                            color: #337ab7;
                                        }

                                        .md-comment {
                                            border: 0px solid black;
                                            background-color: white;
                                            color: white;
                                        }
                                    </style>

                                    <div class="col-xs-12 col-sm-12 col-md-12">
                                        <div class="row">
                                            {% for elem in numbers %}
                                                <div class="col-xs-1 col-sm-1 col-md-1">
                                                    <div class="row">
                                                        <a class="md-btn btn btn-default btn-block"
                                                           id="md-btn-{{ elem }}"><i
                                                                class="md-ico fa fa-pencil-square-o fa-2x"></i></a>
                                                    </div>
                                                </div>
                                                <div class="col-xs-11 col-sm-11 col-md-11">
                                                    <div class="row">
                                                        <div class="md-hover" id="markdown-row-{{ elem }}"></div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col-xs-12">
                        <form>
                            <div class="form-group">
                                <label for="comment">Your Comment</label>
                                <textarea name="comment" class="form-control" rows="3" style="resize: none;"></textarea>
                            </div>

                        </form>
                    </div>
                    <div class="col-xs-12">
                        <button type="submit" class="btn btn-default">Send</button>
                    </div>
                </div>
                <br>
            </div>
        </div>
    </div>
{% endblock %}

{% block add_script %}
    <script>
        $(init);


        var startDiv = '<div class="container"><div class="row"><div class="col-md-2"></div><div class="col-md-8">';
        var header = '<label class="text-center btn-primary btn-block">EDIT PARAGRAPH</label>';
        var textarea1 = '<p><textarea id="edittext" required class="btn-block newtext" rows="15" style="resize: none; font-family: Consolas;color: #0f0f0f;" wrap="soft">';
        var textarea2 = '</textarea></p>';
        var comments = '<p><input type="text" required class="btn-block" rows="2" style="resize: none; font-family: Consolas;color: #0f0f0f;" wrap="soft" placeholder="Enter your comments..."></textarea></p>';
        var editInput = '<button id="editinput" type="submit" class="btn btn-block btn-primary btnedit" style="border-radius: 0px;">Edit </button>';
        var cancelInput = '<button type="submit" class="btn btn-block btn-primary btncancel" style="border-radius: 0px;">Cancel </button>';
        var endDiv = '</div><div class="col-md-2"></div></div></div>';

        {% for p in paragraphs %}
            var back{{ p.index|escapejs }};
            var md{{ p.index|escapejs }} = '{{ p.text|escapejs }}';
            document.getElementById('markdown-row-{{ p.index|escapejs }}').innerHTML = marked(md{{ p.index|escapejs }});
            $('#md-btn-{{ p.index|escapejs }}').attr('style', 'height: ' + $('#markdown-row-{{ p.index|escapejs }}').height() + 'px;');

            var front{{ p.index|escapejs }} = document.getElementById("markdown-row-{{ p.index|escapejs }}")
                    , back_content
                    , back{{ p.index|escapejs }};

        {% endfor %}

        function init() {
            {% for p in paragraphs %}
                $('#md-btn-{{ p.index|escapejs }}').bind('click', flip{{ p.index|escapejs }});
            {% endfor %}
        }

        {% for p in paragraphs %}
            function flip{{ p.index|escapejs }}() {
                back{{ p.index|escapejs }} = flippant.flip(front{{ p.index|escapejs }}, startDiv + header + textarea1 + md{{ p.index|escapejs }} + textarea2 + comments + editInput + cancelInput + endDiv, 'modal');
                back{{ p.index|escapejs }}.addEventListener('click', function (e) {
                    if (e.target.classList.contains('btncancel')) {
                        back{{ p.index|escapejs }}.close();
                    }
                    else if (e.target.classList.contains('btnedit')) {
                        md{{ p.index|escapejs }} = back{{ p.index|escapejs }}.querySelector('textarea').value;
                        document.getElementById('markdown-row-{{ p.index|escapejs }}').innerHTML = marked(md{{ p.index|escapejs }});
                        $('#md-btn-{{ p.index|escapejs }}').attr('style', 'height: ' + $('#markdown-row-{{ p.index|escapejs }}').height() + 'px;');
                        back{{ p.index|escapejs }}.close();
                    }
                })
            }
        {% endfor %}
    </script>
{% endblock %}