{% extends 'main.html' %}
{% load bootstrap3 %}
{% block page_name %}
    <div class="container" style="margin-top: 50px;" xmlns="http://www.w3.org/1999/html">
        <div class="row">
            <br>
        </div>
    </div>
    <div class="container">
        <div class="row">
        </div>
    </div>
{% endblock %}
{% block content %}
    {% load staticfiles %}

    <div id="sb-site">
        <div class="container" id="main-block">
            <div class="row">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-12 col-md-12"
                             style="border: 1px solid #d5d5d5;min-height:105px;border-bottom: none;">
                            <div class="row">
                                <label class="text-center btn-primary btn-block wikicode-theme-header">{{ publication.title|upper }}</label>
                            </div>
                            <div class="row">
                                <br>
                                <div class="col-md-6 col-xs-12">
                                    {% if publication.is_show_author %}
                                        <div class="container-fluid text-left">
                                            <div class="row">
                                                <a href="/user/{{ publication.id_author }}"
                                                   class="btn btn-link" style="text-decoration: none; color: black;"><span class="glyphicon glyphicon-user"></span> {{ publication.nickname_author }}
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                                {% if publication.is_saving or publication.is_loading %}
                                    <div class="col-md-6 col-xs-12">
                                        <div class="container-fluid text-right">
                                            <div class="row">
                                                <div class="btn-group">
                                                    {% if publication.is_saving %}
                                                        <a id="wikicode-up-right-button" class="btn" data-toggle="modal"
                                                           data-target="#modal_save_publication"><span
                                                                class="glyphicon glyphicon-floppy-save"></span> ({{ publication.saves }})</a>
                                                    {% endif %}
                                                    {% if publication.is_loading %}
                                                        <a id="wikicode-up-right-button" class="btn"><span
                                                                class="glyphicon glyphicon-download" data-toggle="modal" data-target="#modal_load_publication"></span> (0)</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr>
                                {% endif %}
                                <div class="tabbable-panel"
                                     style="border-bottom: 0px solid #000000; border-top: 0px solid black;">
                                    <div class="tabbable-pills">
                                        <ul class="nav nav-tabs" style="border-bottom: none;">
                                            <li class="active"><a href="#tab_default_1" data-toggle="tab"
                                                                  id="wiki-publ-tab-1">Конспект </a></li>

                                            <li class="pull-right"><a href="#tab_default_7" data-toggle="tab" id="wiki-publ-tab-7" style="color: black;"><span class="glyphicon glyphicon-cog"></span></a>
                                            </li>
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="tab_default_1">
                                                <div class="col-xs-12 col-sm-12 col-md-12"
                                                     style="border: 1px solid #d5d5d5;">
                                                    <div class="row">
                                                        <ul class="border" id="row-paragraphs">
                                                            {% if module_dynamic_paragraphs %}
                                                                {% for elem in numbers %}
                                                                    <li id="li-md-wikicode-{{ elem }}" class="task"
                                                                        data-id="{{ elem }}">
                                                                        <a id="wiki-anchor" name="{{ elem }}"></a>
                                                                        <div class="md-hover"
                                                                             id="markdown-row-{{ elem }}"></div>
                                                                    </li>
                                                                {% endfor %}
                                                            {% else %}
                                                                {% for elem in numbers %}
                                                                    <li id="li-md-wikicode-{{ elem }}">
                                                                        <a id="wiki-anchor" name="{{ elem }}"></a>
                                                                        <div class="md-hover"
                                                                             id="markdown-row-{{ elem }}"></div>
                                                                    </li>
                                                                {% endfor %}
                                                            {% endif %}
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="col-xs-12">
                                                    <div class="row">
                                                        <br>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane" id="tab_default_7">
                                                <div class="col-xs-12" style="border: 1px solid #d5d5d5;height: 500px;">
                                                    <div class="col-md-5 col-sm-5 col-xs-12">
                                                        <br>
                                                        <div class="row">
                                                            <a href="/publ_manager/{{ publication.id_publication }}"
                                                               class="btn btn-block" id="wiki-style-btn">Панель
                                                                управления конспектом</a>
                                                        </div>
                                                        <br>
                                                        <div class="row">
                                                            <a href="#" class="btn btn-block btn-default"
                                                               id="wiki-style-btn-save-publ">Сохранить изменения в
                                                                конспекте</a>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-2 col-sm-2 col-xs-0"></div>
                                                    <div class="col-md-5 col-sm-5 col-xs-12">
                                                        <br>
                                                        <div class="row">
                                                            <form action="{% url 'presentation' publication.id_publication %}"
                                                                  method="post">
                                                                {% csrf_token %}
                                                                <button type="submit" class="btn btn-block"
                                                                        id="wiki-style-btn">Перейти в режим презентации
                                                                </button>
                                                            </form>
                                                        </div>
                                                        <br>
                                                        <div class="row">
                                                            <button class="btn btn-block" id="wiki-style-btn"
                                                                    data-toggle="modal"
                                                                    data-target="#modal_develop_func">Тема оформления
                                                                конспекта
                                                            </button>
                                                        </div>
                                                        <br>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if publication.is_contents %}
        <button class="btn-lg" id="contents-pollSlider-button"><span class="glyphicon glyphicon-bookmark"></span>
        </button>
    {% endif %}

    <a class="btn-lg" id="up-pollSlider-button" href="#top"><span class="glyphicon glyphicon-arrow-up"></span> </a>

    {% if publication.is_file_tree or publication.is_contents %}
        <div id="wiki-left-page" class="sb-slidebar sb-left sb-width-custom">
            <br><br><br><br><br>
            {% if publication.is_file_tree %}
                <div id="left-slidebar-publications">
                    <label class="btn-block btn-primary text-center">КОНСПЕКТЫ {{ publication.nickname_author|upper }}</label>
                    {% if preview_tree == "NONE" %}
                        <div class="col-xs-12 text-center">
                            <label>Дерево отсутствует</label>
                        </div>
                    {% else %}
                        <ul id="tree2">
                            <!--Здесь должен располагаться сгенерированный html preview дерева-->
                            {{ preview_tree|safe }}
                        </ul>
                    {% endif %}
                </div>
            {% endif %}
            {% if publication.is_contents %}
                <div id="left-slidebar-contents">
                    <label class="btn-block btn-primary text-center">ОГЛАВЛЕНИЕ</label>
                    <div class="row" id="contents-publication"></div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if module_dynamic_paragraphs %}
        <!--Контекстное меню для абзацев-->
        <nav id="context-menu" class="context-menu">
            <ul class="context-menu__items">
                {% if publication.is_dynamic_paragraphs %}
                    <li id="lt-context-menu-1" class="context-menu__item"><a id="comment_paragraph_wiki_tree_context"
                                                                             data-toggle="modal"
                                                                             data-target="#modal_dynamic_comment"
                                                                             class="context-menu__link"
                                                                             data-action="Comment"
                                                                             style="text-decoration: none;"><i
                            class="fa fa-comment"></i> Комментировать</a></li>
                {% endif %}
                {% if is_editable %}
                    <li id="lt-context-menu-2" class="context-menu__item"><a id="edit_paragraph_wiki_tree_context"
                                                                             class="context-menu__link"
                                                                             data-action="Edit"
                                                                             style="text-decoration: none;"><i
                            class="fa  fa-pencil-square-o"></i> Редактировать</a></li>
                {% endif %}
                <li id="lt-context-menu-3" class="context-menu__item"><a id="error_paragraph_wiki_tree_context"
                                                                         data-toggle="modal"
                                                                         data-target="#modal_develop_func"
                                                                         class="context-menu__link" data-action="Error"
                                                                         style="text-decoration: none;"><i
                        class="fa fa-exclamation-triangle"></i> Указать на ошибку</a></li>
                <li id="lt-context-menu-4" class="context-menu__item"><a id="copy_paragraph_wiki_tree_context"
                                                                         data-toggle="modal"
                                                                         data-target="#modal_develop_func"
                                                                         class="context-menu__link" data-action="Copy"
                                                                         style="text-decoration: none;"><i
                        class="fa fa-clone"></i> Копировать</a></li>
            </ul>
        </nav>
    {% endif %}

        <!--Выбранный номер параграфа. Заполняется в скрипте отвечающим за контекстное меню-->
        <input hidden value="" id="selected_number_paragraph">


    {% if publication.is_saving %}
        <!--Модальное окно для сохранения конспекта  -->
        <div class="modal fade" id="modal_save_publication" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Сохранение конспекта</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            {% if publication.id_author == user_id %}
                                <div class="col-xs-12 text-center">
                                    <h4>Вы являетесь автором данного конспекта, поэтому не можете его сохранить</h4>
                                </div>
                            {% elif user_id != -1 %}
                                <form action="{% url 'save_page' publication.id_publication %}" method="post">
                                    {% csrf_token %}
                                    <div class="col-xs-12">
                                        <h5>Укажите путь к папке, в которую хотите сохранить этот конспект</h5>
                                        <h5>При сохранении конспекта ему автоматически присваивается звезда</h5>
                                        <br>
                                    </div>
                                    <div class="col-xs-10">
                                        <input required id="save-publ-path-folder-show" type="text"
                                               class="form-control btn-block" placeholder="Укажите путь к папке..."
                                               style="height: 30px; font-family: Courier; border-radius: 0px;"/>
                                        <input hidden id="save-publ-path-folder" name="save_folder">
                                    </div>
                                    <div class="col-xs-2">
                                        <button id="set-path-folder-save" type="button" class="btn btn-default btn-block"
                                                style="height: 30px; border-radius: 0px;"><i class="fa fa-folder-open-o">...</i>
                                        </button>
                                    </div>
                                    <div class="col-xs-12">
                                        <div id="div-choose-folder-save"
                                             style="display: none;border: 1px solid #ececec;background-color: #ffffff;box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.70), 0 2px 10px 0 rgba(0, 0, 0, 0.12);">
                                            <div class="row">
                                                <div class="col-xs-12  text-right">
                                                    <a id="close-choose-folder-path" type="button" class="btn btn-default"
                                                       style="height: 30px; border: 0px solid white;border-radius: 0px;"><i
                                                            class="fa fa-remove"></i></a>
                                                </div>
                                                <div class="col-xs-12"></div>
                                            </div>
                                            <div id="jstree">
                                                <ul>
                                                    <!--Здесь должен располагаться сгенерированный html код, для динамического дерева с одними папками-->
                                                    {{ dynamic_tree|safe }}
                                                </ul>
                                            </div>
                                            <hr>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="col-xs-12 text-right">
                                        <br>
                                        <br>
                                        <button type="submit" id="wiki-style-btn" class="btn" name="">Сохранить</button>
                                    </div>
                                </form>
                            {% else %}
                                <div class="col-xs-12 text-center">
                                    <h4>Войдите в систему, для выполнения данного действия</h4>
                                    <br>
                                    <h4><a href="/login/">Войти</a></h4>
                                    <h4><a href="/registration/">Зарегистрироваться</a></h4>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    {% if publication.is_loading %}
        <!--Модальное окно для загрузки конспекта  -->
        <div class="modal fade" id="modal_load_publication" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Загрузка конспекта</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row text-center">
                            {% if user_id != -1 %}
                                <h4>Выберите формат загрузки конспекта:</h4>
                                <br>
                                <button id="wiki-style-btn" class="btn" style="width: 200px;">Загрузить в pdf</button>
                                <hr>
                                <form action="{% url 'load_md' publication.id_publication %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" id="wiki-style-btn" class="btn" style="width: 200px;">Загрузить в markdown/txt</button>
                                </form>
                                <hr>
                                <button id="wiki-style-btn" class="btn" style="width: 200px;">Загрузить в html</button>
                                <hr>
                            {% else %}
                                <h4>Войдите в систему, для выполнения данного действия</h4>
                                <br>
                                <h4><a href="/login/">Войти</a></h4>
                                <h4><a href="/registration/">Зарегистрироваться</a></h4>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    {% load staticfiles %}
    <script type="text/javascript" src="{% static 'wiki/highlight/highlight.pack.js' %}"></script>
    <script>hljs.initHighlightingOnLoad();</script>
{% endblock %}
{% block add_script %}
{% endblock %}